# 用户相关

> 用户相关的API请求路径都以`/user`开头,不需要Token。

## 用户注册

- 描述：用户注册
- 请求路径：`/user/add`

- 方式：`POST`

- 参数

|  参数名  | 是否必选 |                           格式要求                           | 默认值 |
| :------: | :------: | :----------------------------------------------------------: | :----: |
| username |    是    | 账号：必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为1~10位 |   无   |
| password |    是    | 密码：必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为6~12位 |   无   |
|  email   |    否    |                  邮箱：必须为标准的邮箱格式                  |   无   |
| nickname |    否    |             昵称：必须为字符串形式，长度为1~10位             |   无   |
| user_pic |    否    |                   用户头像：必须为URL形式                    |   无   |

- 响应

| 参数名 |                说明                |
| :----: | :--------------------------------: |
| status |     状态：0表示成功，1表示失败     |
|  msg   | 消息：请求成功的消息或者失败的原因 |

## 用户登陆

- 描述：用户登陆

- 请求路径：`/use/login`

- 方式：`POST`

- 参数

|  参数名  | 是否必选 |                                       格式要求                                       | 默认值 |
| :------: | :------: | :----------------------------------------------------------------------------------: | :----: |
| username |    是    | 账号：必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为1~10位 |   无   |
| password |    是    | 密码：必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为6~12位 |   无   |

- 响应

| 参数名 |                说明                |
| :----: | :--------------------------------: |
| status |     状态：0表示成功，1表示失败     |
|  msg   | 消息：请求成功的消息或者失败的原因 |
|  data  | token：用户的鉴权令牌，14天有效期  |

- 响应参考

```json
{
    "status": 0,
    "message": "登陆成功",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NSwidXNlcm5hbWUiOiJjanEiLCJwYXNzd29yZCI6IiIsIm5pY2tuYW1lIjoi6ZmI5a625by6IiwiZW1haWwiOiIxMjNAcXEuY29tIiwidXNlcl9waWMiOiIiLCJzdGF0dXMiOjAsImlhdCI6MTY1MjY3ODYzNSwiZXhwIjoxNjUyNzY1MDM1fQ.LqEpf6z3J8n9qH5kSQRux00Z4zwbDqI9lc5FkLF7SLg"
    }
}
```



# 个人中心

> 用户相关的API请求路径都以`/my`开头,必需Token才能访问。用户在更新用户信息以及重置密码后，应该重新进行登陆获取新的用户Token。

## 获取用户信息

- 描述：获取用户信息
- 请求路径：`/my/get`

- 方式：`GET`

- 参数：需在请求头中加入`Authorization`参数，值为 `Bearer <token>`

- 响应

| 参数名 |                             说明                             |
| :----: | :----------------------------------------------------------: |
| status |                  状态：0表示成功，1表示失败                  |
|  msg   |              消息：请求成功的消息或者失败的原因              |
|  data  | id(用户的注册序号)，username(用户账号)，nickname(用户昵称)，email（用户邮箱），user_pic（用户邮箱） |

- 响应参考

```json
{
    "status": 0,
    "message": "获取用户信息成功",
    "data": {
        "id": 5,
        "username": "test",
        "nickname": "测试",
        "email": "123@abc.com",
        "user_pic": "http://127.0.0.1/image/5.png"
    }
}
```

## 更新用户信息

- 描述：更新用户信息
- 请求路径：`/my/update`

- 方式：`POST`

- 参数：需在请求头中加入`Authorization`参数，值为 `Bearer <token>`

|  参数名  | 是否必选 |               格式要求               | 默认值 |
| :------: | :------: | :----------------------------------: | :----: |
|  email   |    否    |      邮箱：必须为标准的邮箱格式      |   无   |
| nickname |    否    | 昵称：必须为字符串形式，长度为1~10位 |   无   |
| user_pic |    否    |       用户头像：必须为URL形式        |   无   |

- 响应

| 参数名 |                说明                |
| :----: | :--------------------------------: |
| status |     状态：0表示成功，1表示失败     |
|  msg   | 消息：请求成功的消息或者失败的原因 |

## 重置密码

- 描述：重置用户密码
- 请求路径：`/my/reset`

- 方式：`POST`

- 参数：需在请求头中加入`Authorization`参数，值为 `Bearer <token>`

|   参数名    | 是否必选 |                           格式要求                           | 默认值 |
| :---------: | :------: | :----------------------------------------------------------: | :----: |
| newPassword |    是    | 新密码：必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为6~12位 |   无   |
| oldPassword |    是    | 旧密码：必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为6~12位 |   无   |

- 响应

| 参数名 |                说明                |
| :----: | :--------------------------------: |
| status |     状态：0表示成功，1表示失败     |
|  msg   | 消息：请求成功的消息或者失败的原因 |

# 表说明

## 用户表

### 用户基本信息表

| user_info | id          | username                                                     | phone    | email | nickname | gender | status  | createtime | lastlogin      | level                    | islogin        | age  |
| --------- | ----------- | ------------------------------------------------------------ | -------- | ----- | -------- | ------ | ------- | ---------- | -------------- | ------------------------ | -------------- | ---- |
| 说明      | ID          | 用户名                                                       | 手机号码 | 邮箱  | 昵称     | 性别   | 状态    | 创建时间   | 上一次登陆时间 | 权限                     | 是否为登陆状态 | 年龄 |
| 约束      | UQ,AI,NN,PK | UQ,NN                                                        | UQ       |       |          |        | NN,DF=0 | NN         |                | NN,KF                    | NN,DF=false    | UN   |
| 格式要求  |             | 必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为1~10位 |          |       |          |        |         |            |                | 由用户权限信息表的id进行 |                |      |

### 用户密码表

| user_psd | userid                   | password                                                     | password_1                                                   | password_2                                                   |
| :------- | ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 说明     | 用户ID                   | 密码                                                         | 曾用密码                                                     | 曾曾用密码                                                   |
| 约束     | UQ,AI,NN,PK,FK           | NN                                                           | NN                                                           | NN                                                           |
| 格式要求 | 由用户基本信息表的id约束 | 必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为6~16位 | 必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为6~16位 | 必须为字符串形式，仅限数字或者字母，不能包含空格或者其它特殊符号，长度为6~16位 |

### 用户头像表

| user_pic | userid                   | user_pic                  |
| -------- | ------------------------ | ------------------------- |
| 说明     | 用户ID                   | 用户头像地址              |
| 约束     | UQ,AI,NN,PK,FK           |                           |
| 格式要求 | 由用户基本信息表的id约束 | 必须为URL格式或者文件格式 |



### 用户权限信息表

| user_level | id                 | commit                         | permitions... |
| ---------- | ------------------ | ------------------------------ | ------------- |
| 说明       | ID，权限等级       | 用户权限                       | 权限细分      |
| 约束       | UQ,AI,NN,PK        | UQ,NN                          | DF=false      |
| 格式要求   | id值越高，权限越低 | 从前到后依次为admin,user,guest | 以后再开发    |

## 内容表

### 绘本相关

#### 绘本基本信息表

| book_info | id          | title | image | intro | createtime | tags | VV                 | BV       |
| --------- | ----------- | ----- | ----- | ----- | ---------- | ---- | ------------------ | -------- |
| 说明      | 书本ID      | 标题  | 封图  | 简介  | 上架时间   |      | 访问次数（浏览量） | 借阅次数 |
| 约束      | UQ,AI,NN,PK |       |       |       |            |      |                    |          |
| 格式要求  |             |       |       |       |            |      |                    |          |

#### 绘本分类信息表

| book_tags | id          | name        |
| --------- | ----------- | ----------- |
| 说明      | 标签ID      | 标签名      |
| 约束      | UQ,AI,NN,PK | UQ,AI,NN,PK |
| 格式要求  |             |             |

##### 对应关系表

| book_tags_rel | bookid | tagid  |
| ------------- | ------ | ------ |
| 说明          | 绘本id | 标签id |
| 约束          | NN     | NN     |
| 格式要求      |        |        |



### 信息流相关

#### 信息流表

| streams  | id          | title | image | tags | author | content | edittime |
| -------- | ----------- | ----- | ----- | ---- | ------ | ------- | -------- |
| 说明     | 信息流ID    | 标题  | 封图  | 标签 | 编辑   | 内容    | 编辑时间 |
| 约束     | UQ,AI,NN,PK |       |       |      |        |         |          |
| 格式要求 |             |       |       |      |        |         |          |



